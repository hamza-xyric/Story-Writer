# LIFE-01: Story Entry Processor

**Skill ID**: LIFE-01
**Category**: Life Story
**Priority**: Critical
**Version**: 1.0
**Last Updated**: 2024-12-24

---

## Purpose

Process raw story entries from Hamza, extracting metadata (time period, characters, locations, themes, emotions), generating structured frontmatter, and saving entries in the standard format. This is the entry point for all new stories.

---

## When to Activate

**Automatic Triggers**:
- User shares a memory or story
- User says "I want to write about..."
- User mentions past events, people, or experiences
- User starts with "I remember when..."

**Manual Invocation**:
```
"Process this as a story entry"
"Save this memory"
"Add this to my life story"
"/new-entry"
```

**Related Skills**:
| Skill | Integration |
|-------|-------------|
| LIFE-02 | Extract and create/update character profiles |
| LIFE-03 | Update timeline index |
| LIFE-05 | After saving, invoke for deepening questions |
| LIFE-06 | Extract and track themes |
| LIFE-31 | Sync word counts to parent chapter/book (silent) |
| LIFE-32 | Validate entry data before save |
| LIFE-40 | Dreams lens - domain-specific questions |
| LIFE-41 | Trading lens - domain-specific questions |
| LIFE-42 | Problems lens - domain-specific questions |

---

## Processing Workflow

### Phase 1: Receive Raw Input

Accept the story in any format:
- Stream of consciousness
- Bullet points
- Fragmented memories
- Detailed narrative

**Do NOT require**:
- Dates (estimate if unclear)
- Titles (generate from content)
- Perfect grammar

### Phase 2: Extract Metadata

#### Time Period Detection
```
Explicit: "In 1995..." → time_period: "1995"
Relative: "When I was 10..." → Calculate from birth year
Vague: "During high school..." → time_period: "high-school", precision: "period"
Unknown: No time markers → time_period: "[TO BE DETERMINED]"
```

**Precision Levels**:
- `day`: Specific date known (e.g., "March 15, 1992")
- `month`: Month and year known (e.g., "Summer 1995")
- `year`: Year known (e.g., "1995")
- `period`: Life stage (e.g., "childhood", "college years")
- `decade`: Approximate decade (e.g., "early 90s")

#### Character Extraction
Identify mentioned people:
```
Direct mentions: "My father took me..."
Named: "Uncle Rashid always said..."
Relational: "My best friend at the time..."
Implied: "We went to the park..." (who is 'we'?)
```

For each character, note:
- Name or identifier
- Relationship to Hamza
- Role in this story (protagonist, supporting, mentioned)

#### Location Extraction
```
Cities: "We lived in Karachi..."
Specific: "The house on 4th Street..."
Contextual: "At my grandmother's place..."
General: "Back home...", "At school..."
```

#### Theme Detection
Look for recurring life themes:
```
Family dynamics, Coming of age, Loss and grief,
Achievement, Failure and resilience, Friendship,
Romance, Career, Identity, Faith, Migration,
Education, Health, Adventure, Discovery
```

#### Emotion Tagging
Detect emotional content:
```
Explicit: "I felt so proud..."
Implicit: "My heart was pounding..."
Contextual: Graduation → pride/excitement
Conflicting: "Happy but scared..."
```

#### Domain Detection

Scan content for domain-specific signals and activate relevant lenses.

**Available Domains:**

| Domain | Lens | Detection Signals |
|--------|------|-------------------|
| dreams | LIFE-40 | dream, dreamt, nightmare, sleep, woke up |
| trading | LIFE-41 | trade, market, position, profit, loss, chart |
| problems | LIFE-42 | problem, stuck, frustrated, struggling, challenge |

**Detection Process:**
1. Scan content for domain keywords (case-insensitive)
2. Verify signal is substantial (not passing mention)
3. Add matching domains to `domains: []` array
4. For each domain, invoke corresponding lens skill
5. Collect domain-specific questions from each lens
6. Merge lens questions into "Questions to Explore"

**Multi-domain handling:**
- An entry can match multiple domains (e.g., dreams + trading)
- Each lens contributes 2-3 contextual questions
- Questions are grouped by domain in output

**Reference:** See `story-data/context/lenses.md` for full lens definitions.

### Phase 3: Generate Entry

Create structured markdown file:

```markdown
---
entry_id: E-2024-001
title: "[Generated from content or user-provided]"
date_written: 2024-12-24
time_period: "1995"
time_period_precision: year
characters:
  - id: father
    role: protagonist
  - id: uncle-rashid
    role: supporting
locations:
  - name: "Karachi"
    type: city
  - name: "Grandmother's house"
    type: specific
themes:
  - family
  - childhood
  - discovery
emotion_tags:
  - nostalgia
  - joy
domains: []  # Auto-detected: dreams, trading, problems
completeness: partial
writing_mode: freeform
prompt_used: null
revisit_count: 0
word_count: [calculated]
---

# [Title]

[Original story content, cleaned up for readability but preserving voice]

---

## AI Notes

### Questions to Explore
- [Generated by LIFE-05 after processing]

### Connections Found
- [Links to related entries]

### Consistency Flags
- [Any timeline or factual questions]

---

*Entry created: 2024-12-24 | Last modified: 2024-12-24*
```

### Phase 4: File Naming and Storage

**File naming convention**:
```
YYYY-MM-title-slug.md

Examples:
1995-00-summer-at-grandmas.md     (year known, month unknown)
1992-03-first-day-of-school.md    (specific month known)
0000-00-recurring-dream.md        (no time context)
childhood-learning-to-ride.md     (period-based, no year)
```

**Storage location**:
```
/story-data/entries/[file].md
```

### Phase 5: Trigger Follow-up Skills

After saving entry:
1. **LIFE-02**: Check if new characters need profiles
2. **LIFE-03**: Add to timeline index
3. **Domain Lenses**: For each detected domain, invoke lens skill:
   - `dreams` → LIFE-40: Add dream-specific questions
   - `trading` → LIFE-41: Add trading-specific questions
   - `problems` → LIFE-42: Add problem-specific questions
4. **LIFE-05**: Ask 3-5 deepening questions (after lenses)
5. **LIFE-06**: Update theme tracking
6. **LIFE-20**: Suggest chapter placement (if book structure exists)

### Phase 6: Data Integrity Verification (MANDATORY)

**This phase is REQUIRED. Do not end the session without completing it.**

After entry is saved, MUST complete all steps:

```
1. WORD COUNT VERIFICATION
   [ ] Recalculate word_count from actual content (H1 to ## AI Notes)
   [ ] Update entry.word_count to exact match (0 tolerance)

2. CHARACTER SYNC (LIFE-31)
   [ ] For each character in entry.characters[]:
       - Verify character file exists
       - Add entry_id to character.entries_featured[] if missing

3. LOCATION SYNC (LIFE-31)
   [ ] For each location in entry.locations[]:
       - Verify location file exists
       - Add entry_id to location.entries_featured[] if missing

4. CHAPTER SYNC (LIFE-31)
   [ ] If entry.chapter_id is set:
       - Verify chapter file exists
       - Verify entry_id in chapter.entries[]
       - Recalculate chapter.current_word_count
       - Recalculate book.current_word_count

5. VALIDATION (LIFE-32)
   [ ] Verify entry_id format (E-YYYY-NNN)
   [ ] Verify completeness matches word count
   [ ] Verify all references resolve
```

**Session cannot end until all boxes are checked.**

See `story-data/context/data-standards.md` for all 18 Integrity Rules.

---

## Expansion Mode

When the user wants to add more to an EXISTING entry (not create a new one), activate Expansion Mode.

### When to Use Expansion Mode

**Use Expansion when:**
- User says "I want to add more to [entry]"
- User answers questions from "Questions to Explore" in an entry
- User shares additional details about the SAME memory moment
- User wants to deepen or elaborate on existing content

**Create NEW entry when:**
- It's a genuinely different memory/event
- The thought triggers a completely separate story
- Different time period entirely
- User explicitly wants a new entry

### Expansion Workflow

```
User shares additional content about existing entry
              |
              v
+----------------------------+
| 1. LOCATE ENTRY            |
| - Find entry by ID or title|
| - Read current content     |
| - Note current word_count  |
+----------------------------+
              |
              v
+----------------------------+
| 2. MERGE CONTENT           |
| - Append new content below |
|   existing prose           |
| - Use section break (---)  |
|   if topic shifts          |
| - Preserve original voice  |
+----------------------------+
              |
              v
+----------------------------+
| 3. UPDATE METADATA         |
| - revisit_count += 1       |
| - Recalculate word_count   |
| - Update completeness if   |
|   richer (brief→partial→   |
|   detailed)                |
| - Add new characters/      |
|   locations if mentioned   |
+----------------------------+
              |
              v
+----------------------------+
| 4. REFRESH QUESTIONS       |
| - Remove answered questions|
| - Generate new questions   |
|   based on new content     |
| - Re-run domain lenses     |
+----------------------------+
              |
              v
+----------------------------+
| 5. DATA INTEGRITY (LIFE-31)|
| - Sync new characters      |
| - Sync new locations       |
| - Update word count cascade|
+----------------------------+
```

### Expansion Merge Rules

**Content Placement:**
```markdown
# [Original Title]

[Original prose content - UNTOUCHED]

---

## Added [Date]

[New content goes here]

---

## AI Notes
[Updated questions and connections]
```

**Metadata Updates:**
```yaml
# Before expansion
revisit_count: 0
word_count: 333
completeness: brief

# After expansion
revisit_count: 1
word_count: 512  # Recalculated
completeness: partial  # May upgrade if richer
```

### Completeness Upgrade Rules

| From | To | Condition |
|------|------|-----------|
| brief | partial | Word count > 300 AND has sensory/emotional detail |
| partial | detailed | Word count > 600 AND multiple aspects explored |

### Question Handling

**Questions answered by new content:**
- Move to "Connections Found" with note: "Explored in revisit [date]"

**New questions generated:**
- Based on new content only
- Don't duplicate existing unanswered questions

### Example Expansion

**User says:** "I want to add to the League entry - I remembered how Trinkhalm and I used to stay up until 4am on school nights."

**Before:**
```yaml
revisit_count: 0
word_count: 527
completeness: detailed
```

**After:**
```yaml
revisit_count: 1
word_count: 612
completeness: detailed  # Already detailed, stays same
```

**New content merged:**
```markdown
---

## Added 2024-12-28

I just remembered - we used to stay up until 4am on school nights. The next day would be hell but we didn't care. Those late-night sessions were when we really perfected the combo. I'd set up the cards, he'd come in with Shaco boxes, and suddenly it's 3am and we're laughing about some ridiculous play.

---
```

**Questions refreshed:**
- Removed: "How did you and Trinkhalm meet?" (if answered)
- Added: "What did your parents think about the 4am gaming sessions?"

---

## Extraction Examples

### Example 1: Raw Input
```
I remember when dad took me to the beach for the first time. I must have
been around 5 or 6. The waves scared me at first but then I couldn't stop
running into them. Mom was worried the whole time but dad just laughed.
```

### Example 1: Extracted Metadata
```yaml
time_period: "~1990"
time_period_precision: period
characters:
  - id: father
    role: protagonist
  - id: mother
    role: supporting
locations:
  - name: "Beach"
    type: general
themes:
  - childhood
  - family
  - discovery
  - fear-to-joy
emotion_tags:
  - fear
  - joy
  - excitement
completeness: brief
```

### Example 2: Raw Input
```
March 15, 2015 was the day I finally quit my corporate job. I walked out
of that building at 6pm, took the elevator down, and just stood outside
for 10 minutes. The security guard asked if I was okay. I said yes but
I wasn't sure. Sarah called me that night and we talked for hours.
```

### Example 2: Extracted Metadata
```yaml
time_period: "2015-03-15"
time_period_precision: day
characters:
  - id: sarah
    role: supporting
  - id: security-guard
    role: mentioned
locations:
  - name: "Corporate office"
    type: work
themes:
  - career
  - change
  - uncertainty
  - support
emotion_tags:
  - uncertainty
  - relief
  - anxiety
completeness: detailed
```

---

## Handling Ambiguity

### When time is unclear:
```
Ask: "Do you remember roughly when this happened?
     A year, your age at the time, or a life period
     (childhood, college, etc.) would help."

If no answer: Use [TIME UNKNOWN] and flag for later
```

### When characters are unnamed:
```
Use descriptive IDs:
- "childhood-best-friend"
- "strict-teacher-grade-5"
- "neighbor-uncle"

Note: Ask user to name them when revisiting
```

### When location is vague:
```
Use contextual descriptions:
- "childhood-home"
- "school-primary"
- "parents-workplace"
```

---

## Integration with Other Skills

### LIFE-02 (Character Manager)
After processing, for each character:
- Check if profile exists
- If not, create stub profile
- If yes, add this entry to their mention list

### LIFE-03 (Timeline Builder)
Add entry to timeline index:
```
timeline/index.json → Add entry reference with time_period
```

### LIFE-05 (Emotion Excavator)
After saving, trigger:
- Generate 3-5 deepening questions
- Add questions to AI Notes section

### LIFE-06 (Theme Tracker)
For each detected theme:
- Add entry to theme tracking file
- Note theme strength (primary/secondary)

---

## Output Format

When processing is complete, respond with:

```
## Entry Saved

**Title**: [Title]
**File**: story-data/entries/[filename].md
**Time Period**: [period] ([precision])
**Characters**: [list]
**Themes**: [list]
**Word Count**: [count]

---

### Deepening Questions (from LIFE-05)

1. [Question about emotions]
2. [Question about sensory details]
3. [Question about before/after]

Would you like to:
- [ ] Answer these questions now
- [ ] Add another memory
- [ ] Review the entry
```

---

## Anti-Patterns

**Do NOT**:
- Rewrite the story in a different voice
- Add fictional details
- Assume facts not stated
- Skip saving entries that seem incomplete
- Require perfect dates or names before saving

**DO**:
- Preserve the original voice
- Mark uncertainties explicitly
- Save even fragmentary memories
- Ask clarifying questions gently
- Make metadata easy to update later

---

## Validation Checklist

Before saving an entry:
- [ ] Entry has unique ID (E-YYYY-NNN format)
- [ ] Time period extracted or marked as unknown
- [ ] All mentioned people captured as characters
- [ ] At least one theme identified
- [ ] Emotion tags reflect the content
- [ ] Domains detected and lens skills invoked
- [ ] Completeness level accurately assessed
- [ ] Original voice preserved in content
- [ ] File saved to correct location

---

## Success Criteria

- Every story Hamza shares gets saved
- Metadata is accurate and consistent
- Files are organized and findable
- Follow-up skills are triggered appropriately
- User feels heard, not interrogated

---

*Skill LIFE-01 v1.0 | Life Story System | 2024-12-24*
